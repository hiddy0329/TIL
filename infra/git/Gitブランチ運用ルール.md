# Gitブランチ運用ルールについて

- 社内で開発しているシステムについて、明確なGitブランチ運用ルールを設けたのでその経緯や内容を記録します。

# 1. プロジェクトでのGitのルール

- このプロジェクトでは目的に応じて以下のブランチを使用しています。
  - masterブランチ
  - developブランチ
  - featureブランチ
  - hotfixブランチ

# 2. 各ブランチについて

- メインとなるブランチ
  -  masterブランチ
    - masterブランチは常にリリースできる状態にある最新のソースがマージされたブランチとして扱います。このブランチでの作業はなく、このブランチから本番環境にソース反映を行うことになります。

  - developブランチ
    - リリースする機能ごとの起点となる開発用ブランチです。このdevelopブランチからfeatureブランチを切って作業をし、プルリクエストののち、OKとなったらdevelopブランチにマージします。
    - 他のdevelopブランチが先にmasterにマージされていた場合、masterからdevelopブランチにマージする必要があります。
    - 最終的に安定したらdevelopブランチをmasterにマージし、リリースへ向かいます。
    - masterへのマージ後、developブランチは削除します。

- サポートとなるブランチ
 - featureブランチ
  - developブランチから切って使用します。機能追加の際の作業用ブランチとなります。作業後はdevelopブランチにマージします。
  - 基本的に「''2~3日で完了する内容''」でfeatureブランチを切るようにし、developブランチへのマージ間隔が長くならないようにする。

 - hotfixブランチ
    - 本番環境にリリース後に起きた不具合に対処するためのブランチです。masterブランチからブランチを切り、作業後は緊急度にもよりますが、基本的にmasterにマージし本番反映するとともに、その時点で作業中のdevelopブランチにもマージしておきます。

# 3. プロジェクトでのgitブランチまとめ

|　ブランチ名称　|　内容　|　作業有無　|　from　|　marge into　|
|:-:|:-:|:-:|:-:|:-:|
|　master　|　本番リリース用　|　なし　|　なし　|　なし　|
|　develop　|　機能ごとの起点ブランチ　|　あり　|　master　|　master　|
|　feature　|　機能追加作業用　|　あり　|　develop　|　develop　|
|　hotfix　|　本番環境不具合対応用　|　あり　|　master　|　master, develop　|

# 4. プロジェクトでのgit運用ルールに至った経緯

- 一般的にバージョン管理の際に使用するgitの運用ルールとして「Git-FlowとGitHub-Flow」という2つのフローが存在します。

## Git-Flow

- Git-Flowでは、5つのブランチを使用して開発を行なっていきます。

|　ブランチ名称　|　内容　|　作業有無　|　from　|　marge into　|
|:-:|:-:|:-:|:-:|:-:|
|　master　|　本番リリース用　|　なし　|　なし　|　なし　|
|　develop　|　開発内容の統合ブランチ　|　あり　|　master　|　master　|
|　release　|　リリース前の調整用ブランチ　|　あり　|　develop　|　master,develop　|
|　feature　|　機能追加作業用　|　あり　|　develop　|　develop　|
|　hotfix　|　本番環境不具合対応用　|　あり　|　master　|　master, develop　|

- developブランチを開発内容を統合させるための1本のブランチとして使用し、安定した状態でreleaseブランチへ反映、微調整が済んだらmasterへマージして本番反映というのが主な流れである。

- 以下のような場合に適していると言える。
  - 開発、テスト、リリースの各工程の作業内容が明確である。
  - 同時多発的に機能対応をするということがない。
  - リリース間隔がある程度の期間ある。
  - 急なリリース日変更等が発生しづらい。

## Git-Flowを本プロジェクトに取り入れると？？

|　プロジェクトの特徴　|　Git-Flowは使えるか　|
|:-:|:-:|
|　開発、テスト、リリースの各工程の作業内容が明確である　|　▲　|
|　同時多発的に機能対応をするということがない　|　×　|
|　リリース間隔がある程度の期間ある　|　⚪︎　|
|　急なリリース日変更等が発生しづらい　|　×　|

- 特に「急なリリース変更等が発生しづらい」という点については、直近でもリリース日直前になって変更になったこともあることを考えると、Git-Flowを取り入れるのは少し危険な気もする。というのも、''Git-Flowでは1本のdevelopブランチを安定させることが必要なため、もし先にdevelopにマージしてしまったリリース内容が延期になった場合、一旦そのマージ内容を削除しないといけなくなるから''である。

## GitHub-Flow

- GitHub-FlowはGitHub社でのGitHub開発でも使用されているフローであり、''「細かく開発」「細かく即時リリース」''という開発スタイルに向いている。

|　ブランチ名称　|　内容　|　作業有無　|　from　|　marge into　|
|:-:|:-:|:-:|:-:|:-:|
|　master　|　本番リリース用　|　なし　|　なし　|　なし　|
|　feature　|　機能追加作業用　|　あり　|　master　|　master　|

- 開発作業が発生するたびに最新のmasterブランチからfeatureブランチを切って作業の上、プルリクエストによってコードレビュー。完了したらmasterにマージするとともに即時リリースというのが基本となる。
- 以下のようなパターンに適していると言える。

-- 比較的小規模なプロジェクトである。
-- 同時多発的に機能対応が発生する。
-- レビュー完了後の即マージ、リリースが可能である。

## GitHub-Flowを本プロジェクトに取り入れると？？

|　プロジェクトの特徴　|　Git-Flowは使えるか　|
|:-:|:-:|
|　比較的小規模なプロジェクトである　|　▲　|
|　同時多発的に機能対応が発生する　|　⚪︎　|
|　レビュー完了後の即リリースが可能である　|　×　|

- 特に、「レビュー完了後の即リリースが可能である」という点が怪しい。''基本的に「ユーザー検証」を経てOKであればmasterへマージの上、本番リリースという流れであるのに加え、それほど頻繁に開発とリリースを繰り返すというわけでもない。''

## 以上を踏まえての本プロジェクトでのGit-Flow

- 以上の考察により、本プロジェクトでは、「Git-Flow」と「GitHub-Flow」の良いところを取り入れつつ、少し改良して使っていきたいと考える。
- ポイントはmasterから分岐する「develop」ブランチを1本ではなく、リリースしたい機能ごとに複数切るという点である。その上で各developブランチからfeatureブランチを切って作業の上プルリクエスト、コードレビュー、developへマージという流れをとる。そのdevelopブランチをmasterへマージすればリリース可能だが、リリース日の変更がある場合はマージのタイミングを変えて柔軟に対応する。

# 5. 参考

- [[Git-Flowについて:https://nvie.com/posts/a-successful-git-branching-model/]]
- [[Git-FlowとGitHub-Flowについて:https://atmarkit.itmedia.co.jp/ait/articles/1708/01/news015.html/]]
